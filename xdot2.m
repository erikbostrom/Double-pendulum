% Error dynamics edot = f(t,e,u=0)-L*C*e
function dxdt= xdot2(t,x,g,l1,l2,m,m1,m2,L)
a11 = m+m1+m2;
a12 = l1*(m1+m2)*cos(x(2));
a13 = l2*m2*cos(x(2)+x(3));
a21 = l1*(m1+m2)*cos(x(2));
a22 = l1^2*(m1+m2);
a23 = l1*l2*m2*cos(x(3));
a31 = l2*m2*cos(x(2)+x(3));
a32 = l1*l2*m2*cos(x(3));
a33 = l2^2*m2;

%L=[24.0000   -0.0000    0.0000
%  -11.9896   11.9294    0.0602
%   11.9500  -35.9106   23.9606
%  128.9810   -0.4905   -0.4905
% -133.5520  199.0939  -65.5419
%   72.9876 -278.7294  205.7418];

 C = [1   0    0  0  0  0;
      1   l1   0  0  0  0;
      1 l1+l2 l2  0  0  0];
 
M = [a11 a12 a13;
     a21 a22 a23;
     a31 a32 a33];

f=[l1*(m1+m2)*x(5)^2*sin(x(2)) + l2*m2*x(5)*x(6)*sin(x(2)+x(3))+l2*m2*x(6)^2*sin(x(2)+x(3));% + u;
   g*l1*(m1+m2)*sin(x(2))+g*l2*m2*sin(x(2)+x(3))-l2*m2*x(4)*x(6)*sin(x(2)+x(3)) + l1*l2*m2*x(6)^2*sin(x(3));
   g*l2*m2*sin(x(2)+x(3))+l2*m2*x(4)*x(5)*sin(x(2)+x(3))];

dxdt(1,1) = x(4);
dxdt(2,1) = x(5);
dxdt(3,1) = x(6);
dxdt(4:6,1) = M\f;

dxdt(:,1) = dxdt(:,1) - L*C*[x(1);x(2);x(3);x(4);x(5);x(6)];
return